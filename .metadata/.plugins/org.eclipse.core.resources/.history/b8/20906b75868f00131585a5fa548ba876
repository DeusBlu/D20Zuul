/**
 * the interface a user will use to equip an item
 * @author DeusBlu
 * @version 0.1_8
 *
 */
public class EquipUI 
{
	private static final String[] MAINHAND_OPTIONS = {
        "mh", "main hand", "mainhand", "m h", "main", "m", "ma"
    };
    private static final String[] OFFHAND_OPTIONS = {
        "oh", "off hand", "offhand", "o h", "off", "o", "of"
    };
    private static final String[] YES = {
    	"yes", "y"
    };
    private static final String[] NO = {
    	"no", "n"
    };
	private InputReader reader;
	private Equipment equipment;
	private Inventory backpack;
	
	/**
	 * default constructor for EquipUI
	 */
	public EquipUI()
	{
		reader = new InputReader();
		equipment = new Equipment();
		backpack = new Inventory();
	}
	
	/**
	 * constructor specifying the equipment and inventory to use
	 * @param equipment
	 * @param inventory
	 */
	public EquipUI(Equipment equipment, 
				   Inventory inventory)
	{
		reader = new InputReader();
		setEquip(equipment);
		setInventory(inventory);
		equipUI();
	}
	
	/**
	 * makes sure the Equipment is a valid object
	 * @param equipment
	 */
	private void setEquip(Equipment equipment)
	{
		if(equipment != null){
			this.equipment = equipment;
		}
		else{
			throw new NullPointerException();
		}
	}
	
	/**
	 * makes sure the Inventory is a valid object
	 * @param inventory
	 */
	private void setInventory(Inventory backpack)
	{
		if(backpack != null){
			this.backpack = backpack;
		}
		else{
			throw new NullPointerException();
		}
	}
	
	/**
	 * the main interface for equiping a character
	 */
	private void equipUI()
	{
		Gear toEquip;
		Inventory wasEquipped = new Inventory();
		boolean finished = false;
		int input = 0;
		while(!finished){
			input = 0;
			backpack.showBag();
			System.out.println("What item # would you like to equip?");
			System.out.print("> ");
			while(input == 0){
				input = reader.readInt();
				if(backpack.getGear(input-1) != null){
					toEquip = backpack.removeGear(input-1);
					if(toEquip.getType().equals("2hweapon") && equipment.isDualWield()){
						if(backpack.bagSpace() <= 1){
							System.out.println("Your backpack is full");
							wasEquipped.lootItem(toEquip);
						}
						else{
							if(replace("Main Hand", "Off Hand")){
								wasEquipped.lootItem(equipment.unequip("Main Hand"));
								wasEquipped.lootItem(equipment.unequip("Off Hand"));
								System.out.println(toEquip.getName() + " was equipped!");
								equipment.equip(toEquip.getEquipString(), toEquip);
							}
							else{
								System.out.println(toEquip.getName() + " was returned to your bag");
								wasEquipped.lootItem(toEquip);
							}
						}
					}
					else if(toEquip.getType().equals("1hweapon")){
						String hand = weaponEquip();
						if(replace(hand, null)){
							wasEquipped.lootItem(equipment.unequip(hand));
							wasEquipped.lootItem(equipment.unequip("Both Hands"));
							System.out.println(toEquip.getName() + " was equipped!");
							equipment.equip(hand, toEquip);
						}
						else{
							System.out.println(toEquip.getName() + " was returned to your bag");
							wasEquipped.lootItem(toEquip);
						}
					}
					else{
						if(replace(toEquip.getEquipString(), null)){
							wasEquipped.lootItem(gearCheck(toEquip));
							System.out.println(toEquip.getName() + " was equipped!");
							equipment.equip(toEquip.getEquipString(), toEquip);
						}
						else{
							System.out.println(toEquip.getName() + " was returned to your bag");
							wasEquipped.lootItem(toEquip);
						}
					}
				}
			}
			backpack.transfer(0, wasEquipped);
			backpack.transfer(1, wasEquipped);
			finished = equipAgain();
			backpack.sort();
		}
	}
	
	/**
	 * confirms if you really want to replace one item with the other
	 * @param equip location HashMap key
	 * @return boolean
	 */
	private boolean replace(String gear)
	{
		boolean ask = true;
		boolean replace = true;
		if(equipment.hasGear("Both Hands") && equipment.isDualWield()){
			while(ask){
				System.out.println("Replace these items?");
				System.out.println("--------------------");
				equipment.getGear("Main Hand").printDetails();
				equipment.getGear("Off Hand").printDetails();
				System.out.println();
				System.out.print(">");
				String input = reader.readString();
				for(int i=0; i < YES.length; i++){
	                if(input.equalsIgnoreCase(YES[i])){
	                	ask = false;
	                }
	            }
	            for(int i=0; i < NO.length; i++){
	                if(input.equalsIgnoreCase(NO[i])){
	                     ask = false;
	                     replace = false;
	                }
	            }
	            if(ask){
	                System.out.println("use 'yes' or 'no'");
	            }
			}
		}
		else if(equipment.hasGear("Both Hands") && (gear.equals("Main Hand") || 
				gear.equals("Off Hand"))){
			while(ask){
				System.out.println("Replace this item?");
				System.out.println("------------------");
				equipment.getGear(gear).printDetails();
				System.out.println();
				System.out.print(">");
				String input = reader.readString();
				for(int i=0; i < YES.length; i++){
	                if(input.equalsIgnoreCase(YES[i])){
	                	ask = false;
	                }
	            }
	            for(int i=0; i < NO.length; i++){
	                if(input.equalsIgnoreCase(NO[i])){
	                     ask = false;
	                     replace = false;
	                }
	            }
	            if(ask){
	                System.out.println("use 'yes' or 'no'");
	            }
			}
		}
		else if(equipment.hasGear(gear)){
			while(ask){
				System.out.println("Replace this item?");
				System.out.println("------------------");
				equipment.getGear(gear).printDetails();
				System.out.println();
				System.out.print(">");
				String input = reader.readString();
				for(int i=0; i < YES.length; i++){
	                if(input.equalsIgnoreCase(YES[i])){
	                	ask = false;
	                }
	            }
	            for(int i=0; i < NO.length; i++){
	                if(input.equalsIgnoreCase(NO[i])){
	                     ask = false;
	                     replace = false;
	                }
	            }
	            if(ask){
	                System.out.println("use 'yes' or 'no'");
	            }
			}
		}
		return replace;
	}
	
	/**
	 * this method determines what hand they wish to equip and returns string for the spot
	 * @return equipSpot
	 */
	private String weaponEquip()
	{
		boolean ask = true;
		String answer = "";
        while(ask){
            System.out.println("Which hand to equip to?");
            System.out.print("> ");
            String input = reader.readString();
            for(int i=0; i < MAINHAND_OPTIONS.length; i++){
                if(input.equalsIgnoreCase(MAINHAND_OPTIONS[i])){
                	answer =  "Main Hand";
                	ask = false;
                }
            }
            for(int i=0; i < OFFHAND_OPTIONS.length; i++){
                if(input.equalsIgnoreCase(OFFHAND_OPTIONS[i])){
                     answer = "Off Hand";
                     ask = false;
                }
            }
            if(ask){
                System.out.println("You can equip to main hand or off hand");
            }
        }
        return answer;
	}
	
	/**
	 * asks the user if he would like to equip another item returns boolean
	 * @return boolean
	 */
	private boolean equipAgain()
	{
		boolean answer = false;
		boolean ask = true;
        while(ask){
        	System.out.println("Current Equip:");
        	System.out.println();
        	equipment.showEquip();
            System.out.println("Equip another item?");
            System.out.print("> ");
            String input = reader.readString();
            for(int i=0; i < YES.length; i++){
                if(input.equalsIgnoreCase(YES[i])){
                	answer = false;
                	ask = false;
                }
            }
            for(int i=0; i < NO.length; i++){
                if(input.equalsIgnoreCase(NO[i])){
                     answer = true;
                     ask = false;
                }
            }
            if(ask){
                System.out.println("use 'yes' or 'no'");
            }
        }
        return answer;
	}
	
	/**
	 * checks for 2hweapon, mhweapon, ohweapon and makes sure proper equipment
	 * changes happen
	 * @param Gear - item to equip
	 * @return Gear - the removed item
	 */
	private Gear gearCheck(Gear toEquip)
	{
		if(toEquip.getType().equals("2hweapon") ||
		   toEquip.getType().equals("mhweapon")){
			if(equipment.hasGear("Both Hands")){
				return equipment.unequip("Both Hands");
			}
			else if(equipment.hasGear("Main Hand")){
				return equipment.unequip("Main Hand");
			}
			else if(equipment.hasGear("Off Hand")){
				return equipment.unequip("Off Hand");
			}
			else{
				return equipment.unequip(toEquip.getEquipString());
			}
		}
		return null;
	}
}
